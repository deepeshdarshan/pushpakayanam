<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>District, Sabha, Name Dropdowns</title>
</head>

<body>
    <form>
        <label for="district">District:</label>
        <select id="district">
            <option value="">-- Select District --</option>
        </select>
        <br><br>
        <label for="sabha">Pradeshika Sabha:</label>
        <select id="sabha" disabled>
            <option value="">-- Select Sabha --</option>
        </select>
        <br><br>
        <label for="name">Name:</label>
        <select id="name" disabled>
            <option value="">-- Select Name --</option>
        </select>
    </form>

    <script type="module">
        import { kendraPrathinidhiList } from '/js/master-data.js';
        const data = kendraPrathinidhiList;
        // Get DOM elements
        const districtSelect = document.getElementById('district');
        const sabhaSelect = document.getElementById('sabha');
        const nameSelect = document.getElementById('name');

        // Populate Districts
        for (const district in data) {
            const opt = document.createElement('option');
            opt.value = district;
            opt.textContent = district;
            districtSelect.appendChild(opt);
        }

        // On District Change
        districtSelect.addEventListener('change', function () {
            sabhaSelect.innerHTML = '<option value="">-- Select Sabha --</option>';
            nameSelect.innerHTML = '<option value="">-- Select Name --</option>';
            nameSelect.disabled = true;

            const selectedDistrict = this.value;
            if (!selectedDistrict) {
                sabhaSelect.disabled = true;
                return;
            }

            const sabhas = Object.keys(data[selectedDistrict]);
            sabhas.forEach(sabha => {
                const opt = document.createElement('option');
                opt.value = sabha;
                opt.textContent = sabha;
                sabhaSelect.appendChild(opt);
            });
            sabhaSelect.disabled = false;
        });

        // On Sabha Change
        sabhaSelect.addEventListener('change', function () {
            nameSelect.innerHTML = '<option value="">-- Select Name --</option>';
            const selectedDistrict = districtSelect.value;
            const selectedSabha = this.value;
            if (!selectedSabha) {
                nameSelect.disabled = true;
                return;
            }

            const names = data[selectedDistrict][selectedSabha];
            names.sort(sortByName);
            names.forEach(person => {
                const opt = document.createElement('option');
                opt.value = person.Id;
                opt.textContent = person.Name;
                nameSelect.appendChild(opt);
            });
            nameSelect.disabled = false;
        });

        function sortByName(a, b) {
            return a.Name.localeCompare(b.Name);
        }
    </script>
</body>

</html>