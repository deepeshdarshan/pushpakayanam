<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="പുഷ്പകായനം 2025, പുതുവഴികളിലൂടെ" name="keywords">
    <meta content="57-ാം ദേശീയ സമ്മേളനം | ശ്രീ പുഷ്പകബ്രാഹ്മണ സേവാ സംഘം | എറണാകുളം" name="description">
    <meta property="og:title" content="Shirt/Saree Order Form" />
    <meta property="og:description"
        content="പുഷ്പകായനം 2025, പുതുവഴികളിലൂടെ | 57-ാം ദേശീയ സമ്മേളനം | ശ്രീ പുഷ്പകബ്രാഹ്മണ സേവാ സംഘം | എറണാകുളം" />
    <meta property="og:image" content="https://pushpakayanam.com/img/logo.png" />
    <meta property="og:url" content="https://pushpakayanam.com/main/content/forms/uniform.html" />
    <meta property="og:type" content="website" />
    <script src="/js/common.js"></script>
    <style>
        body {
            background: var(--dreamy-gradient);
        }

        .form-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            background: white;
        }

        .mandatory::after {
            content: "*";
            color: red;
            margin-left: 2px;
        }

        .invalid-feedback {
            display: block;
        }

        .form-control.is-invalid {
            border-color: #dc3545;
        }

        .form-select.is-invalid {
            border-color: #dc3545;
        }

        .form-check-input.is-invalid {
            border-color: #dc3545;
        }

        .btn-primary {
            padding: 12px 30px;
            font-weight: 500;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }

        .form-label {
            font-weight: 500;
            color: #333;
        }

        h2 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-weight: 800;
        }

        .btn-loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .btn-loading::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            margin: auto;
            border: 2px solid transparent;
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
        }

        .form-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            text-align: center;
            display: none;
        }

        .form-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .form-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .form-message.show {
            display: block;
        }

        .instructions {
            background-color: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
        }

        .instructions h5 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .instructions ul {
            margin-bottom: 0;
            color: #424242;
        }

        .price-display {
            font-size: 1.2em !important;
            font-weight: bold !important;
            color: #28a745 !important;
        }

        .evt-form-title-container {
            background: var(--warning-gradient);
        }

        .evt-form-container {
            text-align: center;
            padding: 10px;
            border-radius: 15px;
            border: 1px solid #cdcdd9;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
            position: relative;
        }

        .evt-form-logo-container {
            background: var(--primary-gradient);
            padding: 20px;
            position: relative;
        }

        .evt-form-logo-container::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 23px;
            background: var(--indigo-gradient);
            z-index: -1;
            opacity: 0.8;
        }

        .evt-form-logo-container img {
            max-height: 230px;
            width: auto;
            filter: drop-shadow(0 4px 20px rgba(0, 123, 255, 0.4));
            transition: var(--transition);
        }

        .evt-form-logo-container:hover img {
            transform: scale(1.02);
            filter: drop-shadow(0 8px 30px rgba(0, 123, 255, 0.5));
        }


        @keyframes spin {
            0% {
                transform: translateY(-50%) rotate(0deg);
            }

            100% {
                transform: translateY(-50%) rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-light">

    <!-- Topbar Start -->
    <div id="header-container"></div>
    <!-- Topbar End -->

    <!-- Page Header Start -->
    <div id="page-header-container"></div>
    <!-- Page Header End -->

    <div class="container">
        <div class="form-container">
            <div class="evt-form-container evt-form-logo-container mb-2">
                <img src="/img/logo-detailed.png" alt="Organization Logo" class="img-fluid">
            </div>
            <div class="evt-form-container evt-form-title-container my-4 pt-4">
                <h2 class="text-white"><i class="fas fa-tshirt me-2 text-white"></i>Shirt / Saree Order Form</h2>
            </div>
            <!-- Instructions -->
            <div class="instructions">
                <h5><i class="fas fa-info-circle me-2"></i>Order Instructions</h5>
                <ul>
                    <li>Fill all mandatory fields marked with <span class="text-danger">*</span></li>
                    <li>Complete payment and enter the reference number below</li>
                </ul>
            </div>

            <form id="orderForm" novalidate>
                <!-- Name Field -->
                <div class="mb-3">
                    <label for="name" class="form-label mandatory">Name (പേര്)</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                    <div class="invalid-feedback"></div>
                </div>

                <!-- Phone Field -->
                <div class="mb-3">
                    <label for="phone" class="form-label mandatory">Phone Number (ഫോൺ നമ്പർ)</label>
                    <input type="text" class="form-control" id="phone" name="phone" maxlength="10" required>
                    <div class="invalid-feedback"></div>
                </div>

                <!-- Email Field -->
                <div class="mb-3">
                    <label for="email" class="form-label">Email (ഇമെയിൽ)</label>
                    <input type="email" class="form-control" id="email" name="email">
                    <div class="invalid-feedback"></div>
                </div>

                <!-- Gender Field -->
                <div class="mb-3">
                    <label class="form-label mandatory">Gender (സ്ത്രീ / പുരുഷൻ)</label>
                    <div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="gender" id="male" value="male" required>
                            <label class="form-check-label" for="male">
                                <i class="fas fa-mars me-1"></i>Male (പുരുഷൻ)
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="gender" id="female" value="female"
                                required>
                            <label class="form-check-label" for="female">
                                <i class="fas fa-venus me-1"></i>Female (സ്ത്രീ)
                            </label>
                        </div>
                    </div>
                    <div class="invalid-feedback" id="genderError"></div>
                </div>

                <!-- District Field -->
                <div class="mb-3">
                    <label for="district" class="form-label mandatory">District (ജില്ല)</label>
                    <select class="form-select" id="district" name="district" required>
                        <option value="">Select District</option>
                    </select>
                    <div class="invalid-feedback"></div>
                </div>

                <!-- Pradeshika Sabha Field -->
                <div class="mb-3">
                    <label for="pradeshikaSabha" class="form-label mandatory">Pradeshika Sabha (പ്രാദേശിക സഭാ)</label>
                    <select class="form-select" id="pradeshikaSabha" name="pradeshikaSabha" required disabled>
                        <option value="">Select Pradeshika Sabha</option>
                    </select>
                    <div class="invalid-feedback"></div>
                </div>

                <!-- Shirt Size Field (Hidden by default) -->
                <div class="mb-3" id="shirtSizeContainer" style="display: none;">
                    <label for="shirtSize" class="form-label mandatory">Shirt Size (ഷർട്ട് സൈസ്)</label>
                    <select class="form-select" id="shirtSize" name="shirtSize">
                        <option value="">Select Size</option>
                        <option value="S">S - Small</option>
                        <option value="M">M - Medium</option>
                        <option value="L">L - Large</option>
                        <option value="XL">XL - Extra Large</option>
                        <option value="XXL">XXL - Double Extra Large</option>
                    </select>
                    <div class="invalid-feedback"></div>
                </div>

                <!-- Price Field -->
                <div class="mb-3">
                    <label for="price" class="form-label">Price (വില)</label>
                    <input type="text" class="form-control price-display" id="price" name="price" readonly>
                </div>

                <!-- Payment Date Field -->
                <div class="mb-3">
                    <label for="paymentDate" class="form-label mandatory">Payment Date (പേയ്മെന്റ് തീയതി)</label>
                    <input type="date" class="form-control" id="paymentDate" name="paymentDate" required>
                    <div class="invalid-feedback"></div>
                </div>

                <!-- Payment Reference Field -->
                <div class="mb-3">
                    <label for="paymentRef" class="form-label mandatory">Payment Reference Number (ട്രാൻസാക്ഷൻ
                        നമ്പർ)</label>
                    <div class="form-text">Enter the transaction reference number after making payment
                        (പണം അയച്ചതിനു ശേഷം അതിന്റെ ട്രാൻസാക്ഷൻ നമ്പർ ഇവിടെ ചേർക്കുക)</div>
                    <input type="text" class="form-control" id="paymentRef" name="paymentRef" required>
                    <div class="invalid-feedback"></div>

                </div>

                <!-- Submit Button -->
                <div class="text-end">
                    <button type="submit" class="btn btn-primary btn-md" id="submitBtn">
                        <i class="fas fa-shopping-cart me-2"></i><span id="submitBtnText">Place Order</span>
                    </button>
                </div>
            </form>
            <div id="formMessage" class="form-message" style="margin-top: 25px;"></div>
        </div>
    </div>

    <script type="module">
        import { districtWisePsMap } from "/js/master-data.js";

        let previousPaymentDate = ''; // Store the previous date value

        document.addEventListener('DOMContentLoaded', function () {
            init("uniform");
            populateDistricts();
            setupEventListeners();
            initializePaymentDate();
        });

        function getFormattedTimestamp() {
            const d = new Date();
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            const hours = String(d.getHours()).padStart(2, '0');
            const minutes = String(d.getMinutes()).padStart(2, '0');
            const seconds = String(d.getSeconds()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
        }

        // Initialize payment date field
        function initializePaymentDate() {
            const paymentDateInput = document.getElementById('paymentDate');

            // Keep it blank by default
            paymentDateInput.value = '';
            previousPaymentDate = '';

            // Prevent keyboard input
            paymentDateInput.addEventListener('keydown', function (e) {
                e.preventDefault();
                return false;
            });

            // Prevent paste
            paymentDateInput.addEventListener('paste', function (e) {
                e.preventDefault();
                return false;
            });

            // Monitor changes and prevent deletion once set
            paymentDateInput.addEventListener('change', function (e) {
                if (this.value) {
                    // Date has been set, store it
                    previousPaymentDate = this.value;
                } else if (previousPaymentDate) {
                    // User tried to clear the date, restore previous value
                    this.value = previousPaymentDate;
                    // Show a message to user
                    const feedback = this.nextElementSibling;
                    feedback.textContent = 'Payment date cannot be removed once set.';
                    this.classList.add('is-invalid');
                    setTimeout(() => {
                        feedback.textContent = '';
                        this.classList.remove('is-invalid');
                    }, 3000);
                }
            });

            // Also handle the clear button in some browsers
            paymentDateInput.addEventListener('input', function (e) {
                if (!this.value && previousPaymentDate) {
                    this.value = previousPaymentDate;
                }
            });
        }

        // Populate district dropdown
        function populateDistricts() {
            const districtSelect = document.getElementById('district');
            Object.keys(districtWisePsMap).forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            const form = document.getElementById('orderForm');
            const districtSelect = document.getElementById('district');
            const pradeshikaSabhaSelect = document.getElementById('pradeshikaSabha');
            const phoneInput = document.getElementById('phone');
            const genderInputs = document.querySelectorAll('input[name="gender"]');

            // Phone input validation (numbers only, max 10 digits)
            phoneInput.addEventListener('input', function () {
                this.value = this.value.replace(/[^0-9]/g, '').substring(0, 10);
            });

            // Gender change event
            genderInputs.forEach(input => {
                input.addEventListener('change', function () {
                    handleGenderChange(this.value);
                });
            });

            // District change event
            districtSelect.addEventListener('change', function () {
                const selectedDistrict = this.value;
                populatePradeshikaSabha(selectedDistrict);
            });

            // Form submission
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                if (validateForm()) {
                    const formData = getFormData();
                    const jsonResponse = {
                        timestamp: getFormattedTimestamp(),
                        formData: formData,
                        status: 'success',
                        message: 'Order submitted successfully!'
                    };
                    sendToServer(jsonResponse);
                }
            });

            // Real-time validation
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('blur', function () {
                    validateField(this);
                });

                input.addEventListener('input', function () {
                    if (this.classList.contains('is-invalid')) {
                        validateField(this);
                    }
                });
            });
        }

        // Handle gender selection
        function handleGenderChange(gender) {
            const shirtSizeContainer = document.getElementById('shirtSizeContainer');
            const shirtSizeSelect = document.getElementById('shirtSize');
            const priceInput = document.getElementById('price');

            if (gender === 'male') {
                shirtSizeContainer.style.display = 'block';
                shirtSizeSelect.required = true;
                priceInput.value = '₹460 (Shirt)';
            } else if (gender === 'female') {
                shirtSizeContainer.style.display = 'none';
                shirtSizeSelect.required = false;
                shirtSizeSelect.value = '';
                priceInput.value = '₹490 (Saree)';
            } else {
                shirtSizeContainer.style.display = 'none';
                shirtSizeSelect.required = false;
                shirtSizeSelect.value = '';
                priceInput.value = '';
            }

            // Clear any validation errors for shirt size when hiding
            if (gender !== 'male') {
                shirtSizeSelect.classList.remove('is-invalid');
                shirtSizeSelect.nextElementSibling.textContent = '';
            }
        }

        // Populate Pradeshika Sabha dropdown based on selected district
        function populatePradeshikaSabha(district) {
            const pradeshikaSabhaSelect = document.getElementById('pradeshikaSabha');

            // Clear existing options
            pradeshikaSabhaSelect.innerHTML = '<option value="">Select Pradeshika Sabha</option>';

            if (district && districtWisePsMap[district]) {
                // Enable the dropdown
                pradeshikaSabhaSelect.disabled = false;

                // Populate options
                districtWisePsMap[district].forEach(ps => {
                    const option = document.createElement('option');
                    option.value = ps;
                    option.textContent = ps;
                    pradeshikaSabhaSelect.appendChild(option);
                });
            } else {
                // Disable the dropdown if no district is selected
                pradeshikaSabhaSelect.disabled = true;
            }

            // Reset validation state
            pradeshikaSabhaSelect.classList.remove('is-invalid');
            pradeshikaSabhaSelect.nextElementSibling.textContent = '';
        }

        // Validate individual field
        function validateField(field) {
            const fieldName = field.name;
            const value = field.value.trim();
            let isValid = true;
            let errorMessage = '';

            // Reset validation state
            field.classList.remove('is-invalid');
            let feedback = field.nextElementSibling;
            if (feedback) {
                // Handle radio buttons
                if (field.type === 'radio') {
                    const genderError = document.getElementById('genderError');
                    const selectedGender = document.querySelector('input[name="gender"]:checked');
                    if (!selectedGender) {
                        isValid = false;
                        errorMessage = 'Gender selection is required.';
                        genderError.textContent = errorMessage;
                        genderError.style.display = 'block';
                        field.classList.add('is-invalid');
                    } else {
                        genderError.textContent = '';
                        genderError.style.display = 'none';
                    }
                    return isValid;
                }

                switch (fieldName) {
                    case 'name':
                        if (!value) {
                            isValid = false;
                            errorMessage = 'Name is required.';
                        }
                        break;

                    case 'phone':
                        if (!value) {
                            isValid = false;
                            errorMessage = 'Phone number is required.';
                        } else if (!/^\d{10}$/.test(value)) {
                            isValid = false;
                            errorMessage = 'Phone number must be exactly 10 digits.';
                        }
                        break;

                    case 'email':
                        if (value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                            isValid = false;
                            errorMessage = 'Please enter a valid email address.';
                        }
                        break;

                    case 'district':
                        if (!value) {
                            isValid = false;
                            errorMessage = 'District is required.';
                        }
                        break;

                    case 'pradeshikaSabha':
                        if (!value) {
                            isValid = false;
                            errorMessage = 'Pradeshika Sabha is required.';
                        }
                        break;

                    case 'shirtSize':
                        const selectedGender = document.querySelector('input[name="gender"]:checked');
                        if (selectedGender && selectedGender.value === 'male' && !value) {
                            isValid = false;
                            errorMessage = 'Shirt size is required for male customers.';
                        }
                        break;

                    case 'paymentDate':
                        if (!value) {
                            isValid = false;
                            errorMessage = 'Payment date is required.';
                        }
                        break;

                    case 'paymentRef':
                        if (!value) {
                            isValid = false;
                            errorMessage = 'Payment reference number is required.';
                        }
                        break;
                }

                if (!isValid) {
                    field.classList.add('is-invalid');
                    feedback.textContent = errorMessage;
                } else {
                    feedback.textContent = '';
                }
            }
            return isValid;
        }

        // Validate entire form
        function validateForm() {
            const form = document.getElementById('orderForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            const emailInput = form.querySelector('input[type="email"]');
            let isFormValid = true;

            // Validate all fields
            inputs.forEach(input => {
                if (input.type !== 'radio') {
                    if (!validateField(input)) {
                        isFormValid = false;
                    }
                }
            });

            // Validate gender radio buttons
            const genderInputs = document.querySelectorAll('input[name="gender"]');
            if (genderInputs.length > 0) {
                const anyGenderInput = genderInputs[0];
                if (!validateField(anyGenderInput)) {
                    isFormValid = false;
                }
            }

            // Validate email if provided
            if (emailInput && emailInput.value && !validateField(emailInput)) {
                isFormValid = false;
            }

            return isFormValid;
        }

        // Get form data and create structured object
        function getFormData() {
            const form = document.getElementById('orderForm');
            const formData = new FormData(form);
            const data = {
                name: formData.get('name') || '',
                phone: formData.get('phone') || '',
                email: formData.get('email') || '',
                gender: formData.get('gender') || '',
                district: formData.get('district') || '',
                pradeshikaSabha: formData.get('pradeshikaSabha') || '',
                shirtSize: formData.get('shirtSize') || '',
                price: document.getElementById('price').value || '',
                paymentDate: formData.get('paymentDate') || '',
                paymentRef: formData.get('paymentRef') || ''
            };

            return data;
        }

        function showMessage(message, type) {
            const formMessage = document.getElementById('formMessage');
            formMessage.textContent = message;
            formMessage.className = `form-message ${type} show`;

            setTimeout(() => {
                formMessage.classList.remove('show');
            }, 5000);
        }

        // Function to send JSON data to server
        function sendToServer(jsonData) {
            const submitBtn = document.getElementById('submitBtn');
            const submitBtnText = document.getElementById('submitBtnText');

            document.getElementById('formMessage').classList.remove('show');

            submitBtn.disabled = true;
            submitBtn.classList.add('btn-loading');
            submitBtnText.textContent = 'Processing Order...';

            // Simulate server call (replace with your actual endpoint)
            setTimeout(() => {
                console.log('Order data:', jsonData);
                showMessage('Thank you! Your order has been placed successfully. We will contact you shortly.', 'success');
                document.getElementById('orderForm').reset();
                document.getElementById('pradeshikaSabha').disabled = true;
                document.getElementById('pradeshikaSabha').innerHTML = '<option value="">Select Pradeshika Sabha</option>';
                document.getElementById('shirtSizeContainer').style.display = 'none';
                document.getElementById('price').value = '';
                previousPaymentDate = ''; // Reset the stored payment date

                submitBtn.disabled = false;
                submitBtn.classList.remove('btn-loading');
                submitBtnText.textContent = 'Place Order';
            }, 2000);

            // For production, replace the setTimeout with actual fetch call:
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbxJQLWWNnlXn3cPuJKCBIxjkmqfX5BNc6tYTENQnD_CljsXpk3eHBAo37rnk7M4wzPZRw/exec';
            fetch(scriptUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify(jsonData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Server response:', data);
                    if (data.status === 'success') {
                        showMessage('Thank you! Your order has been placed successfully. We will contact you shortly.', 'success');
                        document.getElementById('orderForm').reset();
                        document.getElementById('pradeshikaSabha').disabled = true;
                        document.getElementById('pradeshikaSabha').innerHTML = '<option value="">Select Pradeshika Sabha</option>';
                        document.getElementById('shirtSizeContainer').style.display = 'none';
                        document.getElementById('price').value = '';
                        previousPaymentDate = ''; // Reset the stored payment date
                    } else {
                        showMessage('Error: ' + (data.message || 'Unknown error occurred'), 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showMessage('Error submitting order: ' + error.message, 'error');
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('btn-loading');
                    submitBtnText.textContent = 'Place Order';
                });

        }
    </script>

    <!-- Footer Start -->
    <div id="footer-container"></div>
    <!-- Footer End -->

</body>

</html>