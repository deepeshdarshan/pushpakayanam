<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="പുഷ്പകായനം 2025, പുതുവഴികളിലൂടെ" name="keywords">
    <meta content="57-ാം ദേശീയ സമ്മേളനം | ശ്രീ പുഷ്പകബ്രാഹ്മണ സേവാ സംഘം | എറണാകുളം" name="description">
    <meta property="og:title" content="Participation form for the delegates" />
    <meta property="og:description"
        content="പുഷ്പകായനം 2025, പുതുവഴികളിലൂടെ | 57-ാം ദേശീയ സമ്മേളനം | ശ്രീ പുഷ്പകബ്രാഹ്മണ സേവാ സംഘം | എറണാകുളം" />
    <meta property="og:image" content="https://pushpakayanam.com/img/logo.png" />
    <meta property="og:url" content="https://pushpakayanam.com/main/content/forms/participation-all.html" />
    <meta property="og:type" content="website" />
    <script src="/js/common.js"></script>
    <script>document.addEventListener("DOMContentLoaded", () => init("del_part_form"));</script>
    <style>
        body {
            background: var(--dreamy-gradient);
        }

        .evt-form {
            border: 1px solid #aab2fa !important;
            border-radius: 15px !important;
            background: var(--light-bg);
        }

        .evt-form-required {
            color: #dc3545;
        }

        .evt-form-conditional-field {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #e3f2fd;
            border-left: 4px solid #007bff;
            border-radius: 0 0.375rem 0.375rem 0;
        }

        .evt-form-error-message {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .evt-form-declaration-text {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.5;
        }

        .evt-form-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #dee2e6;
        }

        .evt-form-section:last-of-type {
            border-bottom: none;
        }

        /* Blue theme customizations */
        .evt-form .form-check-input:checked {
            background-color: #007bff;
            border-color: #007bff;
        }

        .evt-form .form-check-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
        }

        .evt-form .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }

        .evt-form .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }

        .evt-form .btn-primary:focus {
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.5);
        }

        .evt-form .form-control:focus,
        .evt-form .form-select:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
        }

        .card-header {
            border-radius: 15px 15px 0px 0px !important;
        }

        .evt-form .card-header.bg-primary {
            background: linear-gradient(135deg, #3b99f8 0%, #99cffa 100%);
        }

        .evt-form-logo-container {
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #e0f7fa 0%, #80deea 100%);
            border-radius: 15px;
            border: 1px solid #cdcdd9;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
            position: relative;
        }

        .evt-form-logo-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 18px;
            z-index: -1;
        }

        .evt-form-logo-container img {
            max-height: 230px;
            width: auto;
            filter: drop-shadow(0 2px 8px rgba(0, 123, 255, 0.3));
        }
    </style>
</head>

<body>
    <!-- Topbar Start -->
    <div id="header-container"></div>
    <!-- Topbar End -->

    <!-- Page Header Start -->
    <div id="page-header-container"></div>
    <!-- Page Header End -->

    <div class="container mt-5 mb-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Logo Section -->
                <div class="evt-form-logo-container mb-2">
                    <img src="/img/logo-detailed.png" alt="Organization Logo" class="img-fluid">
                </div>

                <div class="card shadow evt-form">
                    <div class="card-header bg-primary text-white">
                        <h1 class="mb-0 h3 text-white">Participation Form</h1>
                    </div>
                    <div class="card-body">
                        <!-- Basic Details Section -->
                        <div class="evt-form-section">
                            <h2 class="h5 mb-4">Basic Details</h2>
                            <div class="mb-3">
                                <label class="form-label">
                                    Designation (ഔദ്യോഗിക പദവി) <span class="evt-form-required">*</span>
                                </label>
                                <div class="mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="designation"
                                            id="designationEC" value="EC">
                                        <label class="form-check-label" for="designationEC">EC Member
                                            (എക്സിക്ക്യൂട്ടിവ്‌ കമ്മിറ്റി അംഗം) </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="designation"
                                            id="designationBharanasamithi" value="Bharanasamithi">
                                        <label class="form-check-label" for="designationBharanasamithi">Bharanasamithi
                                            (ഭരണസമിതി അംഗം)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="designation"
                                            id="designationKendraPradhinidhi" value="Kendra pradhinidhi">
                                        <label class="form-check-label" for="designationKendraPradhinidhi">Kendra
                                            pradhinidhi (കേന്ദ്ര പ്രധിനിധി) </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="designation"
                                            id="designationExOfficio" value="Ex Officio">
                                        <label class="form-check-label" for="designationExOfficio">Ex Officio
                                            (എക്സ് ഒഫീഷ്യോ)</label>
                                    </div>
                                </div>
                                <div class="evt-form-error-message" id="designation-error"></div>
                            </div>

                            <!-- District and Pradeshika Sabha (only for Kendra pradhinidhi) -->
                            <div class="mb-3" id="districtSection" style="display: none;">
                                <label for="district" class="form-label">
                                    District (ജില്ല) <span class="evt-form-required">*</span>
                                </label>
                                <select class="form-select" id="district" name="district" disabled>
                                    <option value="">Select District</option>
                                </select>
                                <div class="evt-form-error-message" id="district-error"></div>
                            </div>

                            <div class="mb-3" id="pradeshikaSabhaSection" style="display: none;">
                                <label for="pradeshikaSabha" class="form-label">
                                    Pradeshika Sabha (പ്രാദേശിക സഭ) <span class="evt-form-required">*</span>
                                </label>
                                <select class="form-select" id="pradeshikaSabha" name="pradeshikaSabha" disabled>
                                    <option value="">Select Pradeshika Sabha</option>
                                </select>
                                <div class="evt-form-error-message" id="pradeshikaSabha-error"></div>
                            </div>

                            <!-- Ex Officio District (only for Ex Officio) -->
                            <div class="mb-3" id="exOfficioDistrictSection" style="display: none;">
                                <label for="exOfficioDistrict" class="form-label">
                                    District (ജില്ല) <span class="evt-form-required">*</span>
                                </label>
                                <select class="form-select" id="exOfficioDistrict" name="exOfficioDistrict" disabled>
                                    <option value="">Select District</option>
                                </select>
                                <div class="evt-form-error-message" id="exOfficioDistrict-error"></div>
                            </div>

                            <!-- Ex Officio Position (only for Ex Officio) -->
                            <div class="mb-3" id="exOfficioPositionSection" style="display: none;">
                                <label for="exOfficioPosition" class="form-label">
                                    Name (Designation) <span class="evt-form-required">*</span>
                                </label>
                                <select class="form-select" id="exOfficioPosition" name="exOfficioPosition" disabled>
                                    <option value="">Select Name (Designation)</option>
                                </select>
                                <div class="evt-form-error-message" id="exOfficioPosition-error"></div>
                            </div>

                            <!-- Name Dropdown (for all designations) -->
                            <div class="mb-3" id="nameDropdownSection" style="display: none;">
                                <label for="memberName" class="form-label">
                                    Name (പേര്) <span class="evt-form-required">*</span>
                                </label>
                                <select class="form-select" id="memberName" name="memberName" disabled>
                                    <option value="">Select Name</option>
                                </select>
                                <div class="evt-form-error-message" id="memberName-error"></div>
                            </div>

                            <div class="mb-3">
                                <label for="phoneNumber" class="form-label">
                                    Phone Number (ഫോൺ നമ്പർ) <span class="evt-form-required">*</span>
                                </label>
                                <input type="text" class="form-control" id="phoneNumber" name="phoneNumber"
                                    maxlength="10">
                                <div class="evt-form-error-message" id="phoneNumber-error"></div>
                            </div>

                            <div class="mb-3">
                                <label for="emailAddress" class="form-label">Email Address (ഇമെയിൽ) </label>
                                <input type="email" class="form-control" id="emailAddress" name="emailAddress">
                                <div class="evt-form-error-message" id="emailAddress-error"></div>
                            </div>
                        </div>

                        <!-- Participation Details Section -->
                        <div class="evt-form-section">
                            <h2 class="h5 mb-4">Participation Details</h2>

                            <div class="mb-3">
                                <label class="form-label">
                                    When do you plan to attend the sammelanam?<br /> (ഏതു ദിവസങ്ങളിലാണ് താങ്കൾ
                                    സമ്മേളനത്തിൽ
                                    പങ്കെടുക്കുവാൻ ആഗ്രഹിക്കുന്നത് ?) <span class="evt-form-required">*</span>
                                </label>
                                <div class="mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="attendancePlan"
                                            id="attendDay1" value="Day 1">
                                        <label class="form-check-label" for="attendDay1">Day 1 (ഒന്നാം ദിവസം)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="attendancePlan"
                                            id="attendDay2" value="Day 2">
                                        <label class="form-check-label" for="attendDay2">Day 2 (രണ്ടാം ദിവസം)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="attendancePlan"
                                            id="attendBothDays" value="Both days">
                                        <label class="form-check-label" for="attendBothDays">Both days (രണ്ടു
                                            ദിവസങ്ങളിലും)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="attendancePlan"
                                            id="unableToAttend" value="Unable to attend">
                                        <label class="form-check-label" for="unableToAttend">Unable to attend (രണ്ടു
                                            ദിവസങ്ങളിലും പങ്കെടുക്കുവാൻ സാധ്യമല്ല)</label>
                                    </div>
                                </div>
                                <div class="evt-form-error-message" id="attendancePlan-error"></div>
                            </div>

                            <!-- Food Preferences Section -->
                            <div class="food-preferences-section" id="foodPreferencesSection" style="display: none;">
                                <h5 class="mb-3">Please select your food preferences (ഭക്ഷണ മുൻഗണനകൾ തിരഞ്ഞെടുക്കുക)
                                    <span class="evt-form-required">*</span>
                                </h5>
                                <div class="checkbox-group" id="foodCheckboxes">
                                    <!-- Food preference checkboxes will be populated here dynamically -->
                                </div>
                                <div class="evt-form-error-message" id="foodPreferences-error"></div>
                            </div>
                        </div>

                        <!-- Additional Details Section -->
                        <div class="evt-form-section">
                            <h2 class="h5 mb-4">Additional Details</h2>

                            <div class="mb-3">
                                <label for="additionalComments" class="form-label">Additional Comments (മറ്റു വിവരങ്ങൾ)
                                </label>
                                <textarea class="form-control" id="additionalComments" name="additionalComments"
                                    rows="4"
                                    placeholder="Any additional comments ... (മറ്റു വിവരങ്ങൾ എന്തെങ്കിലും ഉണ്ടെങ്കിൽ ഇവിടെ ചേർക്കുക ...)"></textarea>
                            </div>
                        </div>

                        <!-- Declaration Section -->
                        <div class="evt-form-section">
                            <h2 class="h5 mb-4">Declaration</h2>

                            <div class="declaration-text mb-3">
                                <p class="mb-2">1. I consent to share this information with sub-committees for smooth
                                    coordination of the Sammelanam. <br />(ഈ സമ്മേളനത്തിന്റെ സുഗമമായ ഏകോപനത്തിനായി മറ്റ്
                                    ഉപസമിതികളുമായി ഈ വിവരങ്ങൾ പങ്കുവെക്കുന്നതിന് ഞാൻ സമ്മതിക്കുന്നു)</p>
                                <p class="mb-0">2. I will promptly inform the Chairman if there are any updates or
                                    changes to the above details. <br />(മേൽപ്പറഞ്ഞ കാര്യങ്ങളിൽ എന്തെങ്കിലും
                                    വ്യത്യാസങ്ങൾ ഉണ്ടെങ്കിൽ, ചുമതലപ്പെട്ടവരെ ഞാൻ ഉടനടി അറിയിക്കുന്നതാണ്)</p>
                            </div>

                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="declarationAccepted"
                                    name="declarationAccepted">
                                <label class="form-check-label font-weight-bold" for="declarationAccepted">
                                    I accept the above declaration (മേൽപ്പറഞ്ഞ കാര്യങ്ങൾ എന്റെ ഉത്തമ ബോധ്യത്തിൽ നിന്നും
                                    ഉള്ളവയാണ് എന്ന് ഇതിനാൽ സാക്ഷ്യപ്പെടുത്തുന്നു) <span
                                        class="evt-form-required">*</span>
                                </label>
                                <div class="evt-form-error-message" id="declarationAccepted-error"></div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-primary" id="submitBtn" onclick="submitForm()">
                                <i class="fas fa-paper-plane me-2"></i><span id="submitText">Submit</span>
                                <span id="submitSpinner" class="spinner-border spinner-border-sm d-none ms-2"
                                    role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </span>
                            </button>
                        </div>

                        <!-- Success/Error Messages -->
                        <div id="messageContainer" class="mt-4" style="display: none;">
                            <div id="messageAlert" class="alert" role="alert"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the ex officio data
        import { ecMemberList, bsMemberList, kendraPrathinidhiList, exOfficioMap, districtWisePsMap } from "/js/master-data.js";

        let formData = {
            phoneNumber: '',
            emailAddress: '',
            designation: '',
            district: '',
            pradeshikaSabha: '',
            memberName: '',
            exOfficioDistrict: '',
            exOfficioPosition: '',
            day1Attendance: '',
            day2Attendance: '',
            additionalComments: '',
            declarationAccepted: false,
            // Food preferences
            day1LunchRequired: false,
            day1DinnerRequired: false,
            noFoodDay1: false,
            day2BreakfastRequired: false,
            day2LunchRequired: false,
            noFoodDay2: false
        };

        // Initialize form
        document.addEventListener('DOMContentLoaded', function () {
            setupEventListeners();
        });

        function setupEventListeners() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', function () {
                    clearError(this.name || this.id);
                    updateFormData();
                });

                input.addEventListener('change', function () {
                    updateFormData();
                });
            });

            // Phone number - numbers only
            document.getElementById('phoneNumber').addEventListener('input', function (e) {
                this.value = this.value.replace(/[^0-9]/g, '');
            });

            // Designation change event
            const designationRadios = document.querySelectorAll('input[name="designation"]');
            designationRadios.forEach(radio => {
                radio.addEventListener('change', function () {
                    handleDesignationChange(this.value);
                    updateFormData();
                });
            });

            // District change event
            document.getElementById('district').addEventListener('change', function () {
                const selectedDistrict = this.value;
                populatePradeshikaSabhaDropdown(selectedDistrict);
                clearError('pradeshikaSabha');
                clearError('memberName');
                updateFormData();
            });

            // Ex Officio District change event
            document.getElementById('exOfficioDistrict').addEventListener('change', function () {
                const selectedDistrict = this.value;
                populateExOfficioPositions(selectedDistrict);
                clearError('exOfficioPosition');
                updateFormData();
            });

            // Pradeshika Sabha change event
            document.getElementById('pradeshikaSabha').addEventListener('change', function () {
                const selectedDistrict = document.getElementById('district').value;
                const selectedPS = this.value;
                const designation = document.querySelector('input[name="designation"]:checked')?.value;

                if (designation === 'Kendra pradhinidhi' && selectedDistrict && selectedPS) {
                    populateKendraPradhinighiNames(selectedDistrict, selectedPS);
                }
                updateFormData();
            });

            // Attendance plan change event
            const attendancePlanRadios = document.querySelectorAll('input[name="attendancePlan"]');
            attendancePlanRadios.forEach(radio => {
                radio.addEventListener('change', function () {
                    updateAttendanceData(this.value);
                    populateFoodPreferences(this.value);
                    updateFormData();
                });
            });

            document.getElementById('submitBtn').addEventListener('click', submitForm);
        }

        function handleDesignationChange(designation) {
            const districtSection = document.getElementById('districtSection');
            const pradeshikaSabhaSection = document.getElementById('pradeshikaSabhaSection');
            const nameDropdownSection = document.getElementById('nameDropdownSection');
            const exOfficioDistrictSection = document.getElementById('exOfficioDistrictSection');
            const exOfficioPositionSection = document.getElementById('exOfficioPositionSection');

            const districtSelect = document.getElementById('district');
            const pradeshikaSabhaSelect = document.getElementById('pradeshikaSabha');
            const memberNameSelect = document.getElementById('memberName');
            const exOfficioDistrictSelect = document.getElementById('exOfficioDistrict');
            const exOfficioPositionSelect = document.getElementById('exOfficioPosition');

            // Reset all sections first
            districtSection.style.display = 'none';
            pradeshikaSabhaSection.style.display = 'none';
            nameDropdownSection.style.display = 'none';
            exOfficioDistrictSection.style.display = 'none';
            exOfficioPositionSection.style.display = 'none';

            districtSelect.disabled = true;
            pradeshikaSabhaSelect.disabled = true;
            memberNameSelect.disabled = true;
            exOfficioDistrictSelect.disabled = true;
            exOfficioPositionSelect.disabled = true;

            // Clear all dropdowns
            districtSelect.value = '';
            pradeshikaSabhaSelect.innerHTML = '<option value="">Select Pradeshika Sabha</option>';
            memberNameSelect.innerHTML = '<option value="">Select Name</option>';
            exOfficioDistrictSelect.value = '';
            exOfficioPositionSelect.innerHTML = '<option value="">Select Name (Designation)</option>';

            // Reset form data
            formData.district = '';
            formData.pradeshikaSabha = '';
            formData.memberName = '';
            formData.exOfficioDistrict = '';
            formData.exOfficioPosition = '';

            if (designation === 'EC') {
                // Show name dropdown, populate with EC members, hide district/PS
                nameDropdownSection.style.display = 'block';
                memberNameSelect.disabled = false;
                populateECMembers();
            } else if (designation === 'Bharanasamithi') {
                // Show name dropdown, populate with BS members, hide district/PS
                nameDropdownSection.style.display = 'block';
                memberNameSelect.disabled = false;
                populateBSMembers();
            } else if (designation === 'Kendra pradhinidhi') {
                // Show district, PS and name dropdown
                districtSection.style.display = 'block';
                pradeshikaSabhaSection.style.display = 'block';
                nameDropdownSection.style.display = 'block';
                districtSelect.disabled = false;
                populateDistrictDropdown();
            } else if (designation === 'Ex Officio') {
                // Show ex officio district and position dropdowns
                exOfficioDistrictSection.style.display = 'block';
                exOfficioPositionSection.style.display = 'block';
                exOfficioDistrictSelect.disabled = false;
                populateExOfficioDistricts();
            }
        }

        function populateExOfficioDistricts() {
            const exOfficioDistrictSelect = document.getElementById('exOfficioDistrict');
            exOfficioDistrictSelect.innerHTML = '<option value="">Select District</option>';

            const districts = Object.keys(exOfficioMap).sort();
            districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                exOfficioDistrictSelect.appendChild(option);
            });
        }

        function populateExOfficioPositions(selectedDistrict) {
            const exOfficioPositionSelect = document.getElementById('exOfficioPosition');
            exOfficioPositionSelect.innerHTML = '<option value="">Select Name (Designation)</option>';

            if (selectedDistrict && exOfficioMap[selectedDistrict]) {
                exOfficioPositionSelect.disabled = false;

                const districtData = exOfficioMap[selectedDistrict];

                // Iterate through all keys that start with "EXO-"
                Object.keys(districtData).forEach(key => {
                    if (key.startsWith('EXO-')) {
                        const person = districtData[key];
                        const option = document.createElement('option');
                        option.value = key; // Use the ID as the value
                        option.textContent = `${person.Name} (${person.Designation})`;
                        exOfficioPositionSelect.appendChild(option);
                    }
                });
            } else {
                exOfficioPositionSelect.disabled = true;
                formData.exOfficioPosition = '';
            }
        }

        function populateECMembers() {
            const memberNameSelect = document.getElementById('memberName');
            memberNameSelect.innerHTML = '<option value="">Select Name</option>';
            ecMemberList.sort((a, b) => a.Name.localeCompare(b.Name, 'en', { sensitivity: 'base' }));
            ecMemberList.forEach(member => {
                const option = document.createElement('option');
                option.value = member.Id;
                option.textContent = member.Name;
                memberNameSelect.appendChild(option);
            });
        }

        function populateBSMembers() {
            const memberNameSelect = document.getElementById('memberName');
            memberNameSelect.innerHTML = '<option value="">Select Name</option>';
            bsMemberList.sort((a, b) => a.Name.localeCompare(b.Name, 'en', { sensitivity: 'base' }));
            bsMemberList.forEach(member => {
                const option = document.createElement('option');
                option.value = member.Id;
                option.textContent = member.Name;
                memberNameSelect.appendChild(option);
            });
        }

        function populateDistrictDropdown() {
            const districtSelect = document.getElementById('district');
            districtSelect.innerHTML = '<option value="">Select District</option>';

            const districts = Object.keys(kendraPrathinidhiList);
            districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        }

        function populatePradeshikaSabhaDropdown(selectedDistrict) {
            const pradeshikaSabhaSelect = document.getElementById('pradeshikaSabha');
            const memberNameSelect = document.getElementById('memberName');

            // Clear existing options
            pradeshikaSabhaSelect.innerHTML = '<option value="">Select Pradeshika Sabha</option>';
            memberNameSelect.innerHTML = '<option value="">Select Name</option>';

            if (selectedDistrict && kendraPrathinidhiList[selectedDistrict]) {
                pradeshikaSabhaSelect.disabled = false;
                memberNameSelect.disabled = true;

                const pradeshikaSabhas = Object.keys(kendraPrathinidhiList[selectedDistrict]);
                pradeshikaSabhas.forEach(ps => {
                    const option = document.createElement('option');
                    option.value = ps;
                    option.textContent = ps;
                    pradeshikaSabhaSelect.appendChild(option);
                });
            } else {
                pradeshikaSabhaSelect.disabled = true;
                memberNameSelect.disabled = true;
                formData.pradeshikaSabha = '';
                formData.memberName = '';
            }
        }

        function populateKendraPradhinighiNames(selectedDistrict, selectedPS) {
            const memberNameSelect = document.getElementById('memberName');

            // Clear existing options
            memberNameSelect.innerHTML = '<option value="">Select Name</option>';

            if (selectedDistrict && selectedPS &&
                kendraPrathinidhiList[selectedDistrict] &&
                kendraPrathinidhiList[selectedDistrict][selectedPS]) {

                memberNameSelect.disabled = false;

                const names = kendraPrathinidhiList[selectedDistrict][selectedPS];
                names.sort((a, b) => a.Name.localeCompare(b.Name, 'en', { sensitivity: 'base' }));
                names.forEach(person => {
                    const option = document.createElement('option');
                    option.value = person.Id;
                    option.textContent = person.Name;
                    memberNameSelect.appendChild(option);
                });
            } else {
                memberNameSelect.disabled = true;
                formData.memberName = '';
            }
        }

        function populateFoodPreferences(attendancePlan) {
            const foodPreferencesSection = document.getElementById('foodPreferencesSection');
            const foodCheckboxesContainer = document.getElementById('foodCheckboxes');

            // Clear existing checkboxes
            foodCheckboxesContainer.innerHTML = '';

            // Reset food preferences in form data
            formData.day1LunchRequired = false;
            formData.day1DinnerRequired = false;
            formData.noFoodDay1 = false;
            formData.day2BreakfastRequired = false;
            formData.day2LunchRequired = false;
            formData.noFoodDay2 = false;

            if (attendancePlan === 'Unable to attend') {
                foodPreferencesSection.style.display = 'none';
                return;
            }

            foodPreferencesSection.style.display = 'block';

            // Add Day 1 options
            if (attendancePlan === 'Day 1' || attendancePlan === 'Both days') {
                // Add Day 1 heading for Both days
                if (attendancePlan === 'Both days') {
                    const day1Heading = document.createElement('h6');
                    day1Heading.className = 'mb-2 mt-2 text-dark';
                    day1Heading.textContent = 'Day 1 Food Preferences:';
                    foodCheckboxesContainer.appendChild(day1Heading);
                }

                const day1Checkboxes = [
                    { id: 'day1LunchRequired', name: 'day1LunchRequired', text: 'Day 1 lunch required (ഒന്നാം ദിവസം ഉച്ചഭക്ഷണം വേണം)' },
                    { id: 'day1DinnerRequired', name: 'day1DinnerRequired', text: 'Day 1 dinner required (ഒന്നാം ദിവസം അത്താഴം വേണം)' },
                    { id: 'noFoodDay1', name: 'noFoodDay1', text: 'No food required for Day 1 (ഒന്നാം ദിവസം ഭക്ഷണം വേണ്ട)', onclick: clearDay1FoodPreferences }
                ];

                day1Checkboxes.forEach(checkbox => {
                    createCheckbox(checkbox, foodCheckboxesContainer);
                });
            }

            // Add Day 2 options
            if (attendancePlan === 'Day 2' || attendancePlan === 'Both days') {
                // Add Day 2 heading for Both days
                if (attendancePlan === 'Both days') {
                    const day2Heading = document.createElement('h6');
                    day2Heading.className = 'mb-2 mt-3 text-dark';
                    day2Heading.textContent = 'Day 2 Food Preferences:';
                    foodCheckboxesContainer.appendChild(day2Heading);
                }

                const day2Checkboxes = [
                    { id: 'day2BreakfastRequired', name: 'day2BreakfastRequired', text: 'Day 2 breakfast required (രണ്ടാം ദിവസം പ്രാതൽ വേണം)' },
                    { id: 'day2LunchRequired', name: 'day2LunchRequired', text: 'Day 2 lunch required (രണ്ടാം ദിവസം ഉച്ചഭക്ഷണം വേണം)' },
                    { id: 'noFoodDay2', name: 'noFoodDay2', text: 'No food required for Day 2 (രണ്ടാം ദിവസം ഭക്ഷണം വേണ്ട)', onclick: clearDay2FoodPreferences }
                ];

                day2Checkboxes.forEach(checkbox => {
                    createCheckbox(checkbox, foodCheckboxesContainer);
                });
            }
        }

        function createCheckbox(checkbox, container) {
            const checkboxDiv = document.createElement('div');
            checkboxDiv.className = 'form-check';

            const input = document.createElement('input');
            input.className = 'form-check-input';
            input.type = 'checkbox';
            input.id = checkbox.id;
            input.name = checkbox.name;
            if (checkbox.onclick) {
                input.onclick = checkbox.onclick; // Assign onclick if provided
            }

            const label = document.createElement('label');
            label.className = 'form-check-label';
            label.setAttribute('for', checkbox.id);
            label.textContent = checkbox.text;

            checkboxDiv.appendChild(input);
            checkboxDiv.appendChild(label);
            container.appendChild(checkboxDiv);

            // Add event listener
            input.addEventListener('change', function () {
                clearError('foodPreferences');
                updateFormData();
            });
        }

        function updateAttendanceData(attendancePlan) {
            switch (attendancePlan) {
                case 'Day 1':
                    formData.day1Attendance = 'YES';
                    formData.day2Attendance = 'NO';
                    break;
                case 'Day 2':
                    formData.day1Attendance = 'NO';
                    formData.day2Attendance = 'YES';
                    break;
                case 'Both days':
                    formData.day1Attendance = 'YES';
                    formData.day2Attendance = 'YES';
                    break;
                case 'Unable to attend':
                    formData.day1Attendance = 'NO';
                    formData.day2Attendance = 'NO';
                    break;
                default:
                    formData.day1Attendance = '';
                    formData.day2Attendance = '';
            }
        }

        function updateFormData() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                const name = input.name || input.id;
                if (input.type === 'checkbox') {
                    formData[name] = input.checked;
                } else if (input.type === 'radio') {
                    if (input.checked) {
                        if (name === 'attendancePlan') {
                            updateAttendanceData(input.value);
                        } else {
                            formData[name] = input.value;
                        }
                    }
                } else {
                    formData[name] = input.value;
                }
            });
        }

        function clearDay1FoodPreferences() {
            // Clear all Day 1 food preferences if "No food required" is checked
            if (document.getElementById('noFoodDay1').checked) {
                document.getElementById('day1LunchRequired').checked = false;
                document.getElementById('day1DinnerRequired').checked = false;
                document.getElementById('day1LunchRequired').disabled = true;
                document.getElementById('day1DinnerRequired').disabled = true;
                formData.day1LunchRequired = false;
                formData.day1DinnerRequired = false;
            } else {
                document.getElementById('day1LunchRequired').disabled = false;
                document.getElementById('day1DinnerRequired').disabled = false;
            }
        }


        function clearDay2FoodPreferences() {
            // Clear all Day 2 food preferences if "No food required" is checked
            if (document.getElementById('noFoodDay2').checked) {
                document.getElementById('day2BreakfastRequired').checked = false;
                document.getElementById('day2LunchRequired').checked = false;
                document.getElementById('day2BreakfastRequired').disabled = true;
                document.getElementById('day2LunchRequired').disabled = true;
                formData.day2BreakfastRequired = false;
                formData.day2LunchRequired = false;
            } else {
                document.getElementById('day2BreakfastRequired').disabled = false;
                document.getElementById('day2LunchRequired').disabled = false;
            }
        }

        function validateForm() {
            const errors = {};

            if (!formData.phoneNumber.trim()) {
                errors.phoneNumber = 'Phone number is required';
            } else if (!/^\d{10}$/.test(formData.phoneNumber)) {
                errors.phoneNumber = 'Phone number must be exactly 10 digits';
            }

            if (formData.emailAddress.trim() && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.emailAddress)) {
                errors.emailAddress = 'Please enter a valid email address';
            }

            if (!formData.designation) {
                errors.designation = 'Please select a designation';
            }

            // Validate based on designation type
            if (formData.designation === 'Ex Officio') {
                if (!formData.exOfficioDistrict) {
                    errors.exOfficioDistrict = 'Please select a district';
                }
                if (!formData.exOfficioPosition) {
                    errors.exOfficioPosition = 'Please select a name (designation)';
                }
            } else if (formData.designation === 'Kendra pradhinidhi') {
                if (!formData.district) {
                    errors.district = 'Please select a district';
                }
                if (!formData.pradeshikaSabha) {
                    errors.pradeshikaSabha = 'Please select a pradeshika sabha';
                }
                if (!formData.memberName) {
                    errors.memberName = 'Please select a name';
                }
            } else if (formData.designation === 'EC' || formData.designation === 'Bharanasamithi') {
                if (!formData.memberName) {
                    errors.memberName = 'Please select a name';
                }
            }

            if (!formData.day1Attendance || !formData.day2Attendance) {
                errors.attendancePlan = 'Please select when you plan to attend the sammelanam';
            }

            // Enhanced food preferences validation
            const attendancePlan = document.querySelector('input[name="attendancePlan"]:checked')?.value;
            if (attendancePlan && attendancePlan !== 'Unable to attend') {
                if (attendancePlan === 'Both days') {
                    // Separate validation for Day 1 and Day 2
                    const day1FoodSelected = formData.day1LunchRequired ||
                        formData.day1DinnerRequired ||
                        formData.noFoodDay1;

                    const day2FoodSelected = formData.day2BreakfastRequired ||
                        formData.day2LunchRequired ||
                        formData.noFoodDay2;

                    if (!day1FoodSelected) {
                        errors.foodPreferences = 'Please select at least one food preference option for Day 1';
                    } else if (!day2FoodSelected) {
                        errors.foodPreferences = 'Please select at least one food preference option for Day 2';
                    }
                } else if (attendancePlan === 'Day 1') {
                    // Validation for Day 1 only
                    const day1FoodSelected = formData.day1LunchRequired ||
                        formData.day1DinnerRequired ||
                        formData.noFoodDay1;

                    if (!day1FoodSelected) {
                        errors.foodPreferences = 'Please select at least one food preference option for Day 1';
                    }
                } else if (attendancePlan === 'Day 2') {
                    // Validation for Day 2 only
                    const day2FoodSelected = formData.day2BreakfastRequired ||
                        formData.day2LunchRequired ||
                        formData.noFoodDay2;

                    if (!day2FoodSelected) {
                        errors.foodPreferences = 'Please select at least one food preference option for Day 2';
                    }
                }
            }

            // Declaration validation
            if (!formData.declarationAccepted) {
                errors.declarationAccepted = 'Please accept the declaration to proceed';
            }

            return errors;
        }

        function displayErrors(errors) {
            showMessage('error', 'Please fix the errors above before submitting the form.');
            // Clear all previous errors
            const errorElements = document.querySelectorAll('.evt-form-error-message');
            errorElements.forEach(el => el.textContent = '');

            // Display new errors
            Object.keys(errors).forEach(field => {
                const errorElement = document.getElementById(field + '-error');
                if (errorElement) {
                    errorElement.textContent = errors[field];
                }

                // Add Bootstrap error styling
                const inputElement = document.getElementById(field) || document.querySelector(`[name="${field}"]`);
                if (inputElement) {
                    inputElement.classList.add('is-invalid');
                }
            });
        }

        function clearError(fieldName) {
            const errorElement = document.getElementById(fieldName + '-error');
            if (errorElement) {
                errorElement.textContent = '';
            }

            // Remove Bootstrap error styling
            const inputElement = document.getElementById(fieldName) || document.querySelector(`[name="${fieldName}"]`);
            if (inputElement) {
                inputElement.classList.remove('is-invalid');
            }
        }

        function clearAllErrors() {
            const errorElements = document.querySelectorAll('.evt-form-error-message');
            errorElements.forEach(el => el.textContent = '');

            const invalidInputs = document.querySelectorAll('.is-invalid');
            invalidInputs.forEach(input => input.classList.remove('is-invalid'));
        }

        function showMessage(type, text) {
            const messageContainer = document.getElementById('messageContainer');
            const messageAlert = document.getElementById('messageAlert');

            messageAlert.className = `alert alert-${type === 'success' ? 'success' : 'danger'}`;
            messageAlert.textContent = text;
            messageContainer.style.display = 'block';

            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    messageContainer.style.display = 'none';
                }, 5000);
            }
        }

        function clearForm() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'checkbox' || input.type === 'radio') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });

            // Reset form data
            formData = {
                phoneNumber: '',
                emailAddress: '',
                designation: '',
                district: '',
                pradeshikaSabha: '',
                memberName: '',
                exOfficioDistrict: '',
                exOfficioPosition: '',
                day1Attendance: '',
                day2Attendance: '',
                additionalComments: '',
                declarationAccepted: false,
                day1LunchRequired: false,
                day1DinnerRequired: false,
                noFoodDay1: false,
                day2BreakfastRequired: false,
                day2LunchRequired: false,
                noFoodDay2: false
            };

            // Reset all sections to initial state
            const districtSection = document.getElementById('districtSection');
            const pradeshikaSabhaSection = document.getElementById('pradeshikaSabhaSection');
            const nameDropdownSection = document.getElementById('nameDropdownSection');
            const exOfficioDistrictSection = document.getElementById('exOfficioDistrictSection');
            const exOfficioPositionSection = document.getElementById('exOfficioPositionSection');
            const foodPreferencesSection = document.getElementById('foodPreferencesSection');
            const districtSelect = document.getElementById('district');
            const pradeshikaSabhaSelect = document.getElementById('pradeshikaSabha');
            const memberNameSelect = document.getElementById('memberName');
            const exOfficioDistrictSelect = document.getElementById('exOfficioDistrict');
            const exOfficioPositionSelect = document.getElementById('exOfficioPosition');

            districtSection.style.display = 'none';
            pradeshikaSabhaSection.style.display = 'none';
            nameDropdownSection.style.display = 'none';
            exOfficioDistrictSection.style.display = 'none';
            exOfficioPositionSection.style.display = 'none';
            foodPreferencesSection.style.display = 'none';

            districtSelect.disabled = true;
            pradeshikaSabhaSelect.disabled = true;
            memberNameSelect.disabled = true;
            exOfficioDistrictSelect.disabled = true;
            exOfficioPositionSelect.disabled = true;

            districtSelect.innerHTML = '<option value="">Select District</option>';
            pradeshikaSabhaSelect.innerHTML = '<option value="">Select Pradeshika Sabha</option>';
            memberNameSelect.innerHTML = '<option value="">Select Name</option>';
            exOfficioDistrictSelect.innerHTML = '<option value="">Select District</option>';
            exOfficioPositionSelect.innerHTML = '<option value="">Select Name (Designation)</option>';

            clearAllErrors();
        }

        function getFormattedTimestamp() {
            const d = new Date();
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            const hours = String(d.getHours()).padStart(2, '0');
            const minutes = String(d.getMinutes()).padStart(2, '0');
            const seconds = String(d.getSeconds()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
        }

        async function submitForm() {
            updateFormData();

            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitSpinner = document.getElementById('submitSpinner');

            submitBtn.disabled = true;
            submitText.textContent = 'Submitting...';
            submitSpinner.classList.remove('d-none');

            // Hide previous messages
            document.getElementById('messageContainer').style.display = 'none';

            const errors = validateForm();
            if (Object.keys(errors).length > 0) {
                displayErrors(errors);
                submitBtn.disabled = false;
                submitText.textContent = 'Submit';
                submitSpinner.classList.add('d-none');
                return;
            }

            try {
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Prepare the final data for submission
                const finalFormData = { ...formData };

                // For Ex Officio, we need to extract the name and designation separately
                if (formData.designation === 'Ex Officio' && formData.exOfficioPosition) {
                    // The exOfficioPosition contains "Name (Designation)"
                    // We'll send it as is, but you can parse it if needed
                    finalFormData.memberName = formData.exOfficioPosition;
                }

                const jsonData = {
                    formData: finalFormData,
                    timestamp: getFormattedTimestamp()
                };
                console.log('Form Submission Data:', jsonData);
                // sendToServer(jsonData);

            } catch (error) {
                showMessage('error', 'Form submission failed. Please try again.');
                submitBtn.disabled = false;
                submitText.textContent = 'Submit';
                submitSpinner.classList.add('d-none');
            }
        }

        function sendToServer(jsonData) {
            console.log('Form Submission Data:', jsonData);

            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitSpinner = document.getElementById('submitSpinner');

            const scriptUrl = 'https://script.google.com/macros/s/AKfycbxhgkPL48iNEaG-sSPdRwBL35Jiax8Mnk1SEUdiya3CMTntzclrvqyEblgOutiFxQEU/exec';
            fetch(scriptUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify(jsonData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Server response:', data);
                    if (data.status === 'success') {
                        clearForm();
                        showMessage('success', 'Form submitted successfully! Thank you for your registration.');
                    } else {
                        showMessage('danger', 'Error: ' + (data.message || 'Unknown error occurred'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showMessage('error', 'Server error occurred. Please try again later.');
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitText.textContent = 'Submit';
                    submitSpinner.classList.add('d-none');
                });
        }

        // Make functions globally available
        window.submitForm = submitForm;
    </script>

    <!-- Footer Start -->
    <div id="footer-container"></div>
    <!-- Footer End -->
</body>

</html>