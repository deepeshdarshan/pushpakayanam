const pageData = {
  index: {
    title: "index",
  },
  venue: {
    title: "VENUE",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Venue", href: "#" },
    ],
  },
  programs: {
    title: "PROGRAMS",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Programs", href: "#" },
    ],
  },
  logo: {
    title: "ലോഗോ പ്രകാശനം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "ലോഗോ പ്രകാശനം", href: "#" },
    ],
  },
  vishu_contest: {
    title: "വിഷു ഫോട്ടോഗ്രാഫി മത്സരം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "വിഷു ഫോട്ടോഗ്രാഫി മത്സരം", href: "#" },
    ],
  },
  orgcom_announcement: {
    title: "സ്വാഗതസംഘ രൂപീകരണം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "സ്വാഗതസംഘ രൂപീകരണം", href: "#" },
    ],
  },
  naming_contest: {
    title: "നാമനിർദ്ദേശ മത്സരം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "നാമനിർദ്ദേശ മത്സരം", href: "#" },
    ],
  },
  walkathon: {
    title: "Walkathon",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "Walkathon", href: "#" },
    ],
  },
  reels_contest: {
    title: "റീൽസ് മത്സരം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "റീൽസ് മത്സരം", href: "#" },
    ],
  },
  team: {
    title: "Our team",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Our team", href: "#" },
    ],
  },
  contact_us: {
    title: "Contact us",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Contact us", href: "#" },
    ],
  },
  orgcom_gallery: {
    title: "സ്വാഗതസംഘ രൂപീകരണം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "സ്വാഗതസംഘ രൂപീകരണം", href: "#" },
    ],
  },
  account_details: {
    title: "Account Details",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Account details", href: "#" },
    ],
  },
  announcements: {
    title: "Announcements",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "#" },
    ],
  },
  revenue_opportunities: {
    title: "Revenue Opportunities",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Revenue Opportunities", href: "#" },
    ],
  },
  gift_coupon: {
    title: "Gift Coupon",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Gift Coupon", href: "#" },
    ],
  },
  website_launch: {
    title: "Website Launch",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "Website Launch", href: "#" },
    ],
  },
  souvenir_contest: {
    title: "Souvenir Naming Contest",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "Souvenir Naming Contest", href: "#" },
    ],
  },
  videos: {
    title: "Hues and Frames",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Gallery", href: "#" },
      { name: "Hues and Frames", href: "#" },
    ],
  },
  photos: {
    title: "Snaps and Scenes",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Gallery", href: "#" },
      { name: "Snaps and Scenes", href: "#" },
    ],
  },
  balolsavam: {
    title: "ബാലോത്സവം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "ബാലോത്സവം", href: "#" },
    ],
  },
  swadhyaya_yajnam: {
    title: "സ്വാദ്ധ്യായ യജ്ഞം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "സ്വാദ്ധ്യായ യജ്ഞം", href: "#" },
    ],
  },
  forms: {
    title: "Forms Dashboard",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Forms Dashboard", href: "#" },
    ],
  },
  follow_us: {
    title: "Follow & Subscribe",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Follow & Subscribe", href: "#" },
    ],
  },
  sponsorship: {
    title: "Sponsorship Tariff",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "Sponsorship Tariff", href: "#" },
    ],
  },
  ekm_part_form: {
    title: "Participation Form - Ernakulam",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Participation form - Ernakulam", href: "#" },
    ],
  },
  del_part_form: {
    title: "Participation Form - Delegates",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Participation form - Delegates", href: "#" },
    ],
  },
  participation_form_districts: {
    title: "Participation Form - Districts",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Participation form - Districts", href: "#" },
    ],
  },
  uniform: {
    title: "Uniform for Pushpakayanam 2025",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "Pushpakayanam 2025 Uniform", href: "#" },
    ],
  },
  varnnolsavam: {
    title: "വർണ്ണോത്സവം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "വർണ്ണോത്സവം", href: "#" },
    ],
  },
  uthradappookkalam: {
    title: "ഉത്രാടപ്പൂക്കളം",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Announcements", href: "/main/content/announcements.html" },
      { name: "ഉത്രാടപ്പൂക്കളം", href: "#" },
    ],
  },
  uniform_form: {
    title: "Shirt/Saree Order Form",
    breadcrumbs: [
      { name: "Home", href: "/index.html" },
      { name: "Shirt/Saree Order Form", href: "#" },
    ],
  },
};

const metas = [
  {
    charset: "UTF-8",
  },
  {
    name: "viewport",
    content: "width=device-width, initial-scale=1.0",
  },
  {
    name: "keywords",
    content:
      "പുഷ്പകായനം 2025, പുതുവഴികളിലൂടെ | 57-ാം ദേശീയ സമ്മേളനം | ശ്രീ പുഷ്പകബ്രാഹ്മണ സേവാ സംഘം",
  },
  {
    name: "description",
    content:
      "പുഷ്പകായനം 2025, പുതുവഴികളിലൂടെ | 57-ാം ദേശീയ സമ്മേളനം | ശ്രീ പുഷ്പകബ്രാഹ്മണ സേവാ സംഘം",
  },
  {
    property: "og:title",
    content:
      "പുഷ്പകായനം 2025, പുതുവഴികളിലൂടെ | 57-ാം ദേശീയ സമ്മേളനം | ശ്രീ പുഷ്പകബ്രാഹ്മണ സേവാ സംഘം",
  },
  {
    property: "og:description",
    content:
      "പുഷ്പകായനം 2025, പുതുവഴികളിലൂടെ | 57-ാം ദേശീയ സമ്മേളനം | ശ്രീ പുഷ്പകബ്രാഹ്മണ സേവാ സംഘം",
  },
  {
    property: "og:image",
    content: "https://pushpakayanam.com/img/logo.png",
  },
  { property: "og:type", content: "website" },
];

const headerScripts = [
  "https://code.jquery.com/jquery-3.4.1.min.js",
  "https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js",
  "/lib/easing/easing.min.js",
  "/lib/waypoints/waypoints.min.js",
  "/lib/owlcarousel/owl.carousel.min.js",
  "/js/main.js",
];

const links = [
  {
    rel: "icon",
    href: "/img/favicon.ico",
    type: "image/x-icon",
  },
  {
    rel: "preconnect",
    href: "https://fonts.googleapis.com",
  },
  {
    rel: "preconnect",
    href: "https://fonts.gstatic.com",
    crossorigin: "true",
  },
  {
    rel: "stylesheet",
    href: "https://fonts.googleapis.com/css2?family=Barlow:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap",
  },
  {
    rel: "stylesheet",
    href: "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css",
  },
  {
    rel: "stylesheet",
    href: "https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css",
  },
  {
    rel: "stylesheet",
    href: "/lib/owlcarousel/assets/owl.carousel.min.css",
  },
  {
    rel: "stylesheet",
    href: "/css/bootstrap.min.css",
  },
  {
    rel: "stylesheet",
    href: "/css/style.css",
  },
];

function copyToClipboard() {
  const copyBtn = document.querySelector(".copy-clipbrd-btn");
  const textToCopy = copyBtn.getAttribute("data-clipboard-text");
  copyBtn.addEventListener("click", function () {
    navigator.clipboard
      .writeText(textToCopy)
      .then(function () {
        const successMsg = document.querySelector(".copy-success-msg");
        successMsg.classList.remove("d-none");

        setTimeout(() => {
          successMsg.classList.add("d-none");
        }, 2000);
      })
      .catch((err) => {
        console.log("Copy failed: " + err);
      });
  });
}

async function init(pageId) {
  loadMeta();
  loadHeadLinks();
  loadHeader();
  loadTitle();
  loadPageHeader(pageId);
  loadFooter();
  loadVisitCounter();
}

async function loadVisitCounter() {
  const module = await import("/js/visit-counter.js");
  module.initVisitCounter();
}

function loadHeader(loadScripts = true) {
  fetch("/main/partials/header.html")
    .then((res) => {
      if (!res.ok) throw new Error("404");
      return res.text();
    })
    .then((html) => {
      const container = document.getElementById("header-container");
      container.innerHTML = html;
      if (loadScripts) {
        loadHeaderScripts();
      }
    })
    .catch(() => {
      console.error("Error loading header:", err);
      const container = document.getElementById("header-container");
      if (container) container.innerHTML = "Header not found.";
    });
}

function loadFooter() {
  fetch("/main/partials/footer.html")
    .then((res) => {
      if (!res.ok) throw new Error("404");
      return res.text();
    })
    .then((html) => {
      const container = document.getElementById("footer-container");
      container.innerHTML = html;
    })
    .catch((err) => {
      console.error("Error loading footer:", err);
      const container = document.getElementById("footer-container");
      if (container) container.innerHTML = "Footer not found.";
    });
}

function loadHeaderScripts() {
  headerScripts.forEach((src) => {
    const script = document.createElement("script");
    script.src = src;
    script.defer = true;
    document.head.appendChild(script);
  });
}

function loadHeadLinks() {
  links.forEach((attrs) => {
    const link = document.createElement("link");
    for (let [key, value] of Object.entries(attrs)) {
      link.setAttribute(key, value);
    }
    document.head.appendChild(link);
  });
}

function loadMeta() {
  metas.forEach((attrs) => {
    const meta = document.createElement("meta");
    for (let [key, value] of Object.entries(attrs)) {
      meta.setAttribute(key, value);
    }

    // Insert charset meta as the first head element
    if (attrs.charset) {
      document.head.insertBefore(meta, document.head.firstChild);
    } else {
      document.head.appendChild(meta);
    }
  });
}

function loadPageHeader(pageId) {
  fetch("/main/partials/page-header.html")
    .then((res) => {
      if (!res.ok) throw new Error(`Page header fetch failed: ${res.status}`);
      return res.text();
    })
    .then((html) => {
      const container = document.getElementById("page-header-container");
      container.innerHTML = html;
      const page = pageData[pageId];
      const pageHeader = document.getElementById("page-header");
      if (page.title === "index") {
        pageHeader.style.display = "none";
        return;
      } else {
        pageHeader.style.display = "block";
        document.getElementById("page-title").textContent = page.title;
        const breadcrumbContainer = document.getElementById(
          "breadcrumb-container"
        );
        const breadcrumbs = page.breadcrumbs;
        if (breadcrumbContainer && breadcrumbs.length) {
          breadcrumbContainer.innerHTML = breadcrumbs
            .map((item, index) => {
              const isLast = index === breadcrumbs.length - 1;
              const href = item.href || "#";
              const name = item.name || "Untitled";
              return isLast
                ? `<a href="${href}">${name}</a>`
                : `<a href="${href}">${name}</a><i class="bi bi-exclude text-primary px-2"></i>`;
            })
            .join("");
        }
      }
    })
    .catch((err) => {
      console.error("Error loading page header:", err);
      const container = document.getElementById("page-header");
      if (container) container.innerHTML = "Page header not available.";
    });
}

function loadTitle() {
  const title = document.createElement("title");
  title.id = "title-txt";
  title.textContent = "പുഷ്പകായനം 2025";
  document.head.appendChild(title);
}

function loadHeaderCarousel() {
  // Initialize carousel
  const photoGallery = new bootstrap.Carousel("#mainPhotoGallery", {
    interval: 5000, // Auto-slide every 5 seconds (set to false to disable)
    wrap: true, // Loop back to first slide after last
    pause: "hover", // Pause on hover
  });

  // Optional: Add keyboard navigation
  document.addEventListener("keydown", function (event) {
    if (event.key === "ArrowLeft") {
      photoGallery.prev();
    } else if (event.key === "ArrowRight") {
      photoGallery.next();
    }
  });

  // Optional: Add touch/swipe support for mobile
  let galleryStartX = 0;
  let galleryEndX = 0;

  const photoGalleryElement = document.getElementById("mainPhotoGallery");

  photoGalleryElement.addEventListener("touchstart", function (event) {
    galleryStartX = event.touches[0].clientX;
  });

  photoGalleryElement.addEventListener("touchend", function (event) {
    galleryEndX = event.changedTouches[0].clientX;
    handleGallerySwipe();
  });

  function handleGallerySwipe() {
    const swipeThreshold = 50;
    const diff = galleryStartX - galleryEndX;

    if (Math.abs(diff) > swipeThreshold) {
      if (diff > 0) {
        photoGallery.next(); // Swipe left - next slide
      } else {
        photoGallery.prev(); // Swipe right - previous slide
      }
    }
  }
}
